---
title: "Prescribing of Beta-blockers: Variations Across Seasons and Health Boards"
author: "B249238"
output: html_document
date: "2025-10-31"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(janitor) # cleaning data
library(gt) # tables
library(here) # directory structure (will be useful later)

```

## Introduction

The aim of this report is to investigate the seasonal changes and changes across NHS Scotland health boards regarding monthly prescribing of beta-blockers.

First we load in data files for the prescriptions in each month of 2024. We also load in data for the Health Boards:

```{r, include=TRUE}

files <- list.files(here("data", "consecutive_data_2024"), pattern = "csv")

consecutive_data <- files %>% 
  map_dfr(~read_csv(here("data", "consecutive_data_2024", .)) %>% 
            mutate(DMDCode = as.character(DMDCode)))

HB_lookup <- read_csv("https://www.opendata.nhs.scot/dataset/9f942fdb-e59e-44f5-b534-d6e17229cc7b/resource/652ff726-e676-4a20-abda-435b98dd7bdc/download/hb14_hb19.csv") %>% 
  clean_names()

```


## Graph


```{r pressure, include=TRUE}

salbutamol_prescription_12months <- consecutive_data %>% 
  clean_names() %>% 
  full_join(HB_lookup, by = c("hbt" = "hb")) %>% 
  select(hb_name, hbt:paid_date_month) %>% 
  mutate(paid_date_month = parse_date_time(paid_date_month, "ym")) %>% 
  filter(str_detect(bnf_item_description, "SALBUTAMOL")) %>% 
  group_by(hb_name, paid_date_month) %>% 
  summarise(paid_quantity = sum(paid_quantity)) %>% 
  filter(!is.na(hb_name))

line_chart <- salbutamol_prescription_12months %>%
  ggplot(aes(x = paid_date_month, y = paid_quantity)) +
  geom_line(color = "darkgreen", linewidth = 1) +
  facet_wrap(~ hb_name, nrow = 3, scales = "free") +
  scale_x_datetime(date_labels = "%b\n%Y", date_breaks = "3 months") +
  labs(x = "Month", y = "Quantity", title = "Salbutamol Prescribing by Health Board") +
  theme_bw()

line_chart

```


These graphs above show the variations in monthly prescribing of salbutamol throughout 2024 for each of the Health boards in Scotland


For the future, I plan to produce similar graphs for other beta-blockers and maybe also graphs for all beta-blockers combined. It might also be useful for me to include a summary table of prescribing of beta-blockers across health boards.

Regarding seasonal changes, I could divide the 12 months into 4 seasons (3 months data combined for total data for each season) but I need to investigate the best way to present the data across seasons.

If I end up having too many graphs, I might decide to only have graphs for data regarding all beta-blockers combined rather than specific beta-blockers like salbutamol.
